---

import Input from "../../Components/Input.astro";

---
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Olvidar Contraseña</title>
  <link rel="stylesheet" href="/path/to/your/styles.css"> <!-- Asegúrate de que la ruta sea correcta -->
</head>
<body>
    <div class="min-h-screen flex items-center justify-center bg-gray-100">
        <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
          <h2 class="text-2xl font-bold text-gray-800 text-center">Recuperar Contraseña</h2>
          <form id="reset-password-form" class="mt-6">
            <div class="mb-4">
              <Input 
                placeholder="Introduce tu correo electrónico" 
                type="email" 
                Text="Correo Electrónico" 
                id="email"
              />
            </div>
            <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-2 rounded-lg">Enviar enlace de recuperación</button>
            <p id="message" class="mt-4 text-center"></p>
          </form>
        </div>
    </div>
    <script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('reset-password-form');
    const messageElement = document.getElementById('message');
    const emailInput = document.querySelector('#email') as HTMLInputElement; // Especifica el tipo HTMLInputElement

    if (form && messageElement && emailInput) {
        form.addEventListener('submit', async function(event) {
            event.preventDefault();

            const email = emailInput.value;

            // Validar formato de correo electrónico
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailPattern.test(email)) {
                messageElement.textContent = 'Introduce un correo electrónico válido.';
                messageElement.classList.remove('text-green-500');
                messageElement.classList.add('text-red-500');
                return;
            }

            try {
                const response = await fetch('http://localhost:4000/api/reset-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email })
                });

                const result = await response.json();

                if (response.ok) {
                    messageElement.textContent = 'El enlace de restablecimiento fue enviado a tu correo.';
                    messageElement.classList.remove('text-red-500');
                    messageElement.classList.add('text-green-500');
                } else {
                    messageElement.textContent = result.error || 'Por favor regístrate para hacer el cambio de contraseña.';
                    messageElement.classList.remove('text-green-500');
                    messageElement.classList.add('text-red-500');
                }
            } catch (error) {
                messageElement.textContent = 'Error al enviar el enlace de restablecimiento.';
                messageElement.classList.add('text-red-500');
            }
        });
    }
});
    </script>
</body>
</html>